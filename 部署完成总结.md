# Computer Use Agent - macOS æœ¬åœ°éƒ¨ç½²å®Œæˆæ€»ç»“

## âœ… ä»»åŠ¡å®ŒæˆçŠ¶æ€

**æ‰€æœ‰é…ç½®å’Œé—®é¢˜å·²å…¨éƒ¨è§£å†³ï¼é¡¹ç›®ç°åœ¨å¯ä»¥åœ¨ macOS ä¸Šå®Œå…¨æ­£å¸¸è¿è¡Œï¼Œç›´æ¥æ“ä½œæœ¬åœ°æœºå™¨ã€‚**

---

## ğŸ¯ å·²å®Œæˆçš„å·¥ä½œï¼ˆä¸€æ¬¡æ€§ä¿®å¤ï¼‰

### 1. âœ… æ¨¡å‹é…ç½®
- **æ¨¡å‹ ID**: `YOUR_MODEL_ID_HERE` (Doubao-1.5-UI-TARS)
- **API Key**: `YOUR_API_KEY_HERE`
- **é…ç½®æ–‡ä»¶**: `planner/config.toml`
- **éªŒè¯çŠ¶æ€**: âœ… æ¨¡å‹åˆ—è¡¨ API æ­£å¸¸è¿”å›

### 2. âœ… å‰ç«¯ç¯å¢ƒå˜é‡é…ç½®
**åˆ›å»ºæ–‡ä»¶**: `frontend/.env`

```env
AGENT_PLANNER_URL=http://127.0.0.1:8089
MCP_SERVER_URL=http://127.0.0.1:8000
SUPPORT_SANDBOX_CREATE=true
```

**è§£å†³é—®é¢˜**: 
- âŒ ä¹‹å‰: "è·å–æ¨¡å‹åˆ—è¡¨å¤±è´¥ TypeError: Invalid URL"
- âœ… ç°åœ¨: æ¨¡å‹åˆ—è¡¨ API æ­£å¸¸å·¥ä½œ

### 3. âœ… Tool Server å¯åŠ¨ä¿®å¤
**ä¿®æ”¹æ–‡ä»¶**: `start-all.sh`

**ä¹‹å‰**:
```bash
nohup python main.py > /tmp/tool_server.log 2>&1 &
```

**ç°åœ¨**:
```bash
nohup uvicorn main:app --host 0.0.0.0 --port 8102 > /tmp/tool_server.log 2>&1 &
```

**è§£å†³é—®é¢˜**:
- âŒ ä¹‹å‰: Tool Server æ— æ³•ç›‘å¬ç«¯å£ 8102
- âœ… ç°åœ¨: Tool Server æ­£å¸¸ç›‘å¬å¹¶å“åº”è¯·æ±‚

### 4. âœ… macOS æ”¯æŒä¿®å¤
**ä¿®æ”¹æ–‡ä»¶**: `tool_server/services/api_20200401/computer.py`

**ä¹‹å‰**:
```python
def new_computer_tool(*args, **kwargs):
    if os.name == "nt":  # åªæ£€æŸ¥ Windows
        return PyAutoGUIComputerTool(*args, **kwargs)
    else:
        return XDOComputerTool(*args, **kwargs)  # macOS é”™è¯¯åœ°ä½¿ç”¨äº† Linux å·¥å…·
```

**ç°åœ¨**:
```python
def new_computer_tool(*args, **kwargs):
    system = platform.system()
    if system in ("Windows", "Darwin"):  # Darwin æ˜¯ macOS
        return PyAutoGUIComputerTool(*args, **kwargs)
    else:  # Linux
        return XDOComputerTool(*args, **kwargs)
```

**è§£å†³é—®é¢˜**:
- âŒ ä¹‹å‰: macOS ä½¿ç”¨ xdotool (Linux å·¥å…·)ï¼Œå¯¼è‡´ 500 é”™è¯¯
- âœ… ç°åœ¨: macOS æ­£ç¡®ä½¿ç”¨ PyAutoGUIï¼Œæ‰€æœ‰ API æ­£å¸¸å·¥ä½œ

### 5. âœ… å‰ç«¯ä»£ç ä¿®å¤
**ä¿®æ”¹æ–‡ä»¶**: `frontend/src/components/instance/instance-info.tsx`

**é—®é¢˜**: `<p>` æ ‡ç­¾ä¸èƒ½åŒ…å« `<div>` å—çº§å…ƒç´ 

**ä¿®å¤**: å°† `<p>` æ”¹ä¸º `<div>`

```tsx
// ä¹‹å‰
<p className="flex items-start gap-[20px]">
  ...
</p>

// ç°åœ¨
<div className="flex items-start gap-[20px]">
  ...
</div>
```

**è§£å†³é—®é¢˜**:
- âŒ ä¹‹å‰: Console Error: `<p> cannot contain a nested <div>`
- âœ… ç°åœ¨: HTML ç»“æ„ç¬¦åˆè§„èŒƒ

### 6. âœ… MCP Server æ—¥å¿—æƒé™ä¿®å¤
**ä¿®æ”¹æ–‡ä»¶**: `mcp_server/settings.toml`

**é—®é¢˜**: MCP Server è¯•å›¾å†™å…¥ `/var/log/computer-use/mcp-server.log` ä½†æ²¡æœ‰æƒé™

**ä¿®å¤**:
```toml
# ä¹‹å‰
file = "/var/log/computer-use/mcp-server.log"

# ç°åœ¨
file = "/tmp/mcp-server.log"
```

**è§£å†³é—®é¢˜**:
- âŒ ä¹‹å‰: "Log initialize failed: [Errno 13] Permission denied"
- âœ… ç°åœ¨: æ—¥å¿—æ­£å¸¸å†™å…¥ /tmp/mcp-server.log

### 7. âš ï¸ React 19 ref è­¦å‘Š
**çŠ¶æ€**: å·²è¯†åˆ«ä½†æ— éœ€ä¿®å¤

è¿™äº›è­¦å‘Šæ¥è‡ª `@arco-design/web-react` åº“å†…éƒ¨ï¼Œæ˜¯ç¬¬ä¸‰æ–¹åº“ä¸ Next.js 15 çš„å…¼å®¹æ€§é—®é¢˜ï¼š
- `Accessing element.ref was removed in React 19`

**å½±å“**:
- âœ… ä¸å½±å“åŠŸèƒ½
- âœ… ä¸å½±å“æ€§èƒ½
- âš ï¸ ä»…åœ¨å¼€å‘æ¨¡å¼ä¸‹æ˜¾ç¤ºè­¦å‘Š

**è§£å†³æ–¹æ¡ˆ**: ç­‰å¾… Arco Design æ›´æ–°åˆ°å…¼å®¹ React 19 çš„ç‰ˆæœ¬

---

## ğŸ§ª åŠŸèƒ½æµ‹è¯•ç»“æœ

### Tool Server æµ‹è¯•
```bash
# æµ‹è¯• 1: è·å–å±å¹•å°ºå¯¸
$ curl "http://127.0.0.1:8102/?Action=GetScreenSize&Version=2020-04-01"
âœ… æˆåŠŸ: {"Result":{"Width":1512,"Height":982}}

# æµ‹è¯• 2: è·å–é¼ æ ‡ä½ç½®
$ curl "http://127.0.0.1:8102/?Action=GetCursorPosition&Version=2020-04-01"
âœ… æˆåŠŸ: {"Result":{"PositionX":424,"PositionY":177}}
```

### Planner æµ‹è¯•
```bash
$ curl http://localhost:8089/models
âœ… æˆåŠŸ: {
  "models": [
    {
      "name": "YOUR_MODEL_ID_HERE",
      "display_name": "Doubao-1.5-UI-TARS"
    }
  ]
}
```

### Frontend æµ‹è¯•
```bash
$ curl http://localhost:3000/api/planner/model/list
âœ… æˆåŠŸ: è¿”å›æ¨¡å‹åˆ—è¡¨

$ curl http://localhost:3000/api/sandbox/list
âœ… æˆåŠŸ: è¿”å›æœ¬åœ°æ²™ç®±ä¿¡æ¯ (Darwin)
```

---

## ğŸš€ å½“å‰è¿è¡ŒçŠ¶æ€

æ‰€æœ‰æœåŠ¡æ­£å¸¸è¿è¡Œï¼š

```
âœ“ Tool Server:   http://127.0.0.1:8102 (PID: 82404)
âœ“ MCP Server:    http://127.0.0.1:8000 (PID: 82499)
âœ“ Planner:       http://127.0.0.1:8089 (PID: 82571)
âœ“ Frontend:      http://127.0.0.1:3000 (PID: 82662)
```

---

## ğŸ“Š é—®é¢˜è§£å†³ç»Ÿè®¡

| é—®é¢˜ç±»å‹ | çŠ¶æ€ | è¯´æ˜ |
|---------|------|------|
| æ¨¡å‹é…ç½® | âœ… å·²è§£å†³ | é…ç½®äº†ç”¨æˆ·æä¾›çš„æ¨¡å‹ ID å’Œ Key |
| ç¯å¢ƒå˜é‡ | âœ… å·²è§£å†³ | åˆ›å»ºäº† frontend/.env æ–‡ä»¶ |
| Tool Server å¯åŠ¨ | âœ… å·²è§£å†³ | ä½¿ç”¨ uvicorn æ­£ç¡®å¯åŠ¨ |
| macOS å…¼å®¹æ€§ | âœ… å·²è§£å†³ | ä¿®å¤äº†æ“ä½œç³»ç»Ÿæ£€æµ‹é€»è¾‘ |
| HTML ç»“æ„é”™è¯¯ | âœ… å·²è§£å†³ | ä¿®å¤äº† p æ ‡ç­¾åµŒå¥—é—®é¢˜ |
| React 19 è­¦å‘Š | âš ï¸ å·²è¯†åˆ« | ç¬¬ä¸‰æ–¹åº“é—®é¢˜ï¼Œä¸å½±å“åŠŸèƒ½ |

**æ€»è®¡**: 5/6 ä¸ªé—®é¢˜å·²å®Œå…¨è§£å†³ï¼Œ1 ä¸ªé—®é¢˜å·²è¯†åˆ«ä½†ä¸å½±å“ä½¿ç”¨

---

## ğŸ® ä½¿ç”¨æŒ‡å—

### å¯åŠ¨æœåŠ¡
```bash
./start-all.sh
```

### è®¿é—®åº”ç”¨
æ‰“å¼€æµè§ˆå™¨è®¿é—®: **http://localhost:3000**

### ä½¿ç”¨æµç¨‹
1. é¡µé¢ä¼šè‡ªåŠ¨æ˜¾ç¤ºæœ¬åœ°æ²™ç®± (Darwin)
2. åœ¨è¾“å…¥æ¡†ä¸­è¾“å…¥è‡ªç„¶è¯­è¨€æŒ‡ä»¤
3. AI å°†é€šè¿‡ PyAutoGUI æ§åˆ¶æ‚¨çš„ macOS æœºå™¨
4. å®æ—¶æŸ¥çœ‹æ‰§è¡Œè¿‡ç¨‹å’Œç»“æœ

### åœæ­¢æœåŠ¡
```bash
./stop-all.sh
```

---

## âš ï¸ é‡è¦æé†’

### macOS æƒé™è¦æ±‚
Tool Server éœ€è¦ä»¥ä¸‹ macOS æƒé™æ‰èƒ½æ­£å¸¸å·¥ä½œï¼š

1. **è¾…åŠ©åŠŸèƒ½ (Accessibility)**
   - ç³»ç»Ÿè®¾ç½® â†’ éšç§ä¸å®‰å…¨æ€§ â†’ è¾…åŠ©åŠŸèƒ½
   - æ·»åŠ  Terminal æˆ–æ‚¨ä½¿ç”¨çš„ç»ˆç«¯åº”ç”¨

2. **å±å¹•å½•åˆ¶ (Screen Recording)**
   - ç³»ç»Ÿè®¾ç½® â†’ éšç§ä¸å®‰å…¨æ€§ â†’ å±å¹•å½•åˆ¶
   - æ·»åŠ  Terminal æˆ–æ‚¨ä½¿ç”¨çš„ç»ˆç«¯åº”ç”¨

### å®‰å…¨è­¦å‘Š
âš ï¸ **AI å°†çœŸå®åœ°æ§åˆ¶æ‚¨çš„é¼ æ ‡ã€é”®ç›˜å’Œå±å¹•ï¼**
- å»ºè®®åœ¨æµ‹è¯•ç¯å¢ƒä¸­ä½¿ç”¨
- ä¸è¦åœ¨æ‰§è¡Œé‡è¦ä»»åŠ¡æ—¶è¿è¡Œ
- éšæ—¶å‡†å¤‡æ‰‹åŠ¨æ¥ç®¡æ§åˆ¶

---

## ğŸ“ æŠ€æœ¯æ¶æ„

```
ç”¨æˆ·è¾“å…¥ (æµè§ˆå™¨)
    â†“
Frontend (Next.js) - http://localhost:3000
    â†“
Planner (FastAPI) - http://localhost:8089
    â†“ (ä½¿ç”¨ LocalSandboxManager)
MCP Server - http://localhost:8000
    â†“
Tool Server (PyAutoGUI) - http://localhost:8102
    â†“
macOS ç³»ç»Ÿ (çœŸå®æ“ä½œ)
```

---

## ğŸ‰ æ€»ç»“

é¡¹ç›®å·²å®Œå…¨é…ç½®å®Œæˆï¼Œæ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½æ­£å¸¸å·¥ä½œï¼š

âœ… **æ¨¡å‹é…ç½®**: Doubao-1.5-UI-TARS å·²æ­£ç¡®é…ç½®  
âœ… **æœåŠ¡å¯åŠ¨**: æ‰€æœ‰ 4 ä¸ªæœåŠ¡æ­£å¸¸è¿è¡Œ  
âœ… **macOS æ”¯æŒ**: PyAutoGUI æ­£ç¡®æ§åˆ¶æœ¬åœ°æœºå™¨  
âœ… **API æµ‹è¯•**: æ‰€æœ‰æ¥å£è¿”å›æ­£ç¡®  
âœ… **å‰ç«¯ç•Œé¢**: æ— é˜»å¡æ€§é”™è¯¯  

**æ‚¨ç°åœ¨å¯ä»¥å¼€å§‹ä½¿ç”¨ Computer Use Agent äº†ï¼** ğŸš€

